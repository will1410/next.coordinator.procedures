April 1:

REMOVE:

//BEGIN creates "Block check" button
 $("#circ_circulation #toolbar #addnewmessageLabel").after("<div class='btn-group'><button id='blockedrep' type='button' class='btn btn-default btn-sm'>Check blocked status</button></div>");
//opens report 3079 for this patron
 var patronxid=$("#circ_circulation #message_form > div:nth-child(2) > input:nth-child(4)").val();
 $("#blockedrep").click( function() {
  window.open('/cgi-bin/koha/reports/guided_reports.pl?reports=3163&phase=Run+this+report&sql_params=' + patronxid + '');
 });


ADD:

//BEGIN Add blocked message to multiple patron pages if patron's login attempts is greater than 5 (requires corresponding css)
 if ( $('.patroninfo').length ) {
  $.getJSON("/cgi-bin/koha/svc/report?id=3187%26param_name=borrowernumber&sql_params=" + ($("input[name=borrowernumber]").val()) + "&annotated=1", function(data) {
   var loginblocked = data[0].CLASS;
   $('body').addClass(loginblocked);
    $('.loginblock #toolbar').before('<div id="blockedpatron"><center><br /><br /><br /><h1>This account is locked due to more than five login attempts with an incorrect password.<br /><br />Use the "Change password" button to set a new password for the patron and unlock the account.</h1><br /><p><button id="blockedrep" type="button">Run blocked status report for this patron</button></p><br /></center></div>');
    $('.loginblock #toolbar').after('<div id="dontedit" style="display: none;"><center><br /><h3>Using "Edit" to modify a password will not unlock the account.  Use "Change password" to unlock the account.</h3><br /></center></div>');
   $('#changepassword').wrapInner('<span id="cphighlight"></span>');
   $( "#editpatron" ).hover(
    function() {
     $('#dontedit').show();
      }, function() {
     $('#dontedit').hide();
     }
    );
   //opens report 3079 for this patron when button is clicked
    var patronxid=$("input[name=borrowernumber]").val();
    $("#blockedrep").click( function() {
     window.open('/cgi-bin/koha/reports/guided_reports.pl?reports=3163&phase=Run+this+report&sql_params=' + patronxid + '');
    });
  });
 }

to IntranetUserJS


DONE: added to IntranetUserCSS on March 25

#blockedpatron {background-color: yellow; border-radius: 10px;}
#dontedit {background-color: red; color: white; visibility: none; border-radius: 10px;}
#cphighlight {outline: 7px solid green; background-color: green; color: white;}

to IntranetUserCSS


DONE: added this SQL to report 3187 on March 25

SELECT
  If(borrowers.login_attempts > 4, "loginblock", "") AS CLASS
FROM
  borrowers
WHERE
  borrowers.login_attempts > 4 AND
  borrowers.borrowernumber = <<enter borrower id>>

  to reports
