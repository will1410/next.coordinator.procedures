

-----

Reports note structure for NExpress:

<div id=reportinfo>
<p>What it does</p>
<ul><li>WHEN</li>
<li>Whose Stuff</li>
<li>grouped by</li>
<li>sorted by</li>
<li>links</li>
</ul><br />
<p><ins>Notes:</ins></p>
<p></p>
<p>Report created at the request of _(blank)_.</p>
<p>Report created by George Williams.</p>
<p>Report created by George Williams.</p>
<p>Report created by Heather Braum.  Explanatory notes added by GHW on _(blank)_.</p>
<p>Report created by Heather Braum.  Explanatory notes added and query updated by GHW on _(blank)_.</p>
<p><a href="/cgi-bin/koha/reports/guided_reports.pl?reports= XX PUT REPORTNUMBER HERE and remove XXs and Spaces XX &phase=Run%20this%20report"  target="_blank">Click here to run in a new window</a></p>
</div>

--

additional bits:

(Explanatory note added by GHW)


This report was created at the request of INT at BRANCH.

--

---

css bits

This CSS in intranetusercss will cause the background on the notes to display differently once the report is run.

.rep .yui-t1 #bd #yui-main .yui-b td #reportinfo {font-size: inherit; font-weight: inherit; background-color: inherit;}
.rep .yui-t1 #bd #yui-main .yui-b #reportinfo {font-size: 14px; font-weight: normal; background-color: #FFFF66;}

---

jQuery bits:

the report note needs the following jQuery in the Intranet jQuery setup in order to work correctly:

//BEGIN remove reports info styling from table display
$('#table_reports #reportinfo').removeAttr('style');
//END

-----

Date range Snippets:

1. During the specified date range<br />(between the beginning of the day on the specified "START DATE" to the end of the day on the specified "END DATE")

(DATEFIELD BETWEEN <<between the beginning of the day on "START DATE"|date>>  AND (<<and the end of the day on "END DATE"|date>>+ INTERVAL 1 DAY))

--

2. During the previous calendar month<br />(between the beginning of the day on the 1st of the previous month through the final day of the previous month)

(DATEFIELD BETWEEN  (concat(date_format(LAST_DAY(now() - interval 1 month),'%Y-%m-'),'01')) AND (concat(date_format(LAST_DAY(now()),'%Y-%m-'),'01')))

--

3. During the previous calendar week<br />(between the beginning of the day two Sundays ago through the end of the day on the previous Saturday)

(DATEFIELD BETWEEN (curdate() - INTERVAL DAYOFWEEK(curdate())+6 DAY) AND (curdate() - INTERVAL DAYOFWEEK(curdate())-1 DAY))

--

4. On the previous day<br />(between 12:00 a.m. yesterday through 11:59 p.m. yesterday)

(DATEFIELD BETWEEN (DATE_SUB(CURDATE(), interval 1 day)) AND (CURDATE()))

--

5. Alternative way of doing previous calendar month:

Month(action_logs.timestamp) = Month(Now() - INTERVAL 1 MONTH) AND
Year(action_logs.timestamp) = Year(Now() - INTERVAL 1 MONTH)

-----

NOW - DATEFIELD

Date_Format(From_Days(DateDiff(Now(), TABLE.DATEFIELD)), "%Y") + 0 AS YEARS_ENROLLED

(for example)

Borrower's Birthday

Date_Format(From_Days(DateDiff(Now(), borrowers.dateofbirth)), "%Y") + 0 AS AGE

Years since registration

Date_Format(From_Days(DateDiff(Now(), borrowers.dateenrolled)), "%Y") + 0 AS YEARS_ENROLLED

-----

ROLLUP advice:

When using "GROUP BY XX WITH ROLLUP" have the more general / broader fields to the left and make the fields more specific as you move to the right.

CUBE is not an option with Koha - the current version of MySQL does not support it.

-----

Using GROUPS authorised values:

The authorised values categorized under "GROUPS" match exactly the "categorycodes" in the "branchcategories" table with the addition of "%" as the authorised value for a description titled "All districts and groups."

If you want the results based solely on the category codes:

1. If you want the results to only include the categorycode, join using the phrase:

JOIN branchrelations ON MYTABLE.MYCOLUMN = branchrelations.branchcode

--

2. If you want the results to only include the categoryname, join using the phrases:


JOIN branchrelations ON MYTABLE.MYCOLUMN = branchrelations.branchcodeJOIN branchcategories ON branchrelations.categorycode = branchcategories.categorycode
--

3. Use "LIKE" instead of "=" to connect "branchrelations.categorycode" to the authorised values in "GROUPS" because the "%" wildcard will not work when you use the "=" symbol:

(branchrelations.categorycode LIKE <<Choose a library group|GROUPS>>) AND (branchrelations.categorycode <>'PUB' and branchrelations.categorycode <>'SCHOOL')

--

4. Also include this phrase in as a WHERE statement to keep from getting data from unwanted "categorycodes:"

(branchrelations.categorycode <>'PUB' and branchrelations.categorycode <>'SCHOOL')

--

-----

Standard AS statements:

CHECKOUTS_PLUS_RENEWALS

CHECK_OUT_BRANCH

CHECK_OUT_GROUP_DISTRICT

CHECK_IN_BRANCH

CHECK_IN_GROUP_DISTRICT

PATRON_HOME_LIBRARY

ITEM_HOME_LIBRARY
